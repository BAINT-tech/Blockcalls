<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlockCall - Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.0/dist/ethers.umd.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
  
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold mb-8 text-center">BlockCall Test</h1>
    
    <!-- Wallet Section -->
    <div class="bg-gray-800 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-bold mb-4">Wallet Connection</h2>
      
      <div id="walletDisconnected">
        <button 
          onclick="connectWallet()"
          class="w-full py-4 bg-cyan-500 hover:bg-cyan-600 rounded-lg font-bold text-lg"
        >
          Connect Wallet
        </button>
      </div>
      
      <div id="walletConnected" class="hidden">
        <div class="bg-green-900/30 border border-green-500 rounded-lg p-4">
          <p class="text-green-400 font-bold mb-2">âœ… Wallet Connected</p>
          <p class="font-mono text-sm break-all" id="walletAddress"></p>
          <button 
            onclick="disconnectWallet()"
            class="mt-4 px-4 py-2 bg-red-500 hover:bg-red-600 rounded"
          >
            Disconnect
          </button>
        </div>
      </div>
    </div>

    <!-- Test Buttons -->
    <div class="bg-gray-800 rounded-lg p-6">
      <h2 class="text-xl font-bold mb-4">Test Buttons</h2>
      
      <button 
        onclick="testAlert()"
        class="w-full py-3 bg-blue-500 hover:bg-blue-600 rounded-lg mb-3"
      >
        Test 1: Simple Alert (Tests if JS works)
      </button>
      
      <button 
        onclick="testMetaMask()"
        class="w-full py-3 bg-purple-500 hover:bg-purple-600 rounded-lg mb-3"
      >
        Test 2: Check MetaMask (Tests if MetaMask installed)
      </button>
      
      <button 
        onclick="testBackend()"
        class="w-full py-3 bg-green-500 hover:bg-green-600 rounded-lg"
      >
        Test 3: Backend Connection (Tests API)
      </button>
    </div>

    <!-- Results -->
    <div id="results" class="mt-8 bg-gray-800 rounded-lg p-6 hidden">
      <h2 class="text-xl font-bold mb-4">Test Results:</h2>
      <pre id="resultText" class="bg-black p-4 rounded text-green-400 overflow-auto"></pre>
    </div>
  </div>

  <script>
    // ==========================================
    // SIMPLE TEST FUNCTIONS
    // ==========================================
    
    let wallet = null;

    function showResult(message) {
      document.getElementById('results').classList.remove('hidden');
      document.getElementById('resultText').textContent = message;
      console.log(message);
    }

    function testAlert() {
      alert('âœ… JavaScript is working!');
      showResult('âœ… Test 1 PASSED: JavaScript is working!');
    }

    async function testMetaMask() {
      if (typeof window.ethereum !== 'undefined') {
        showResult('âœ… Test 2 PASSED: MetaMask is installed!\n\nVersion: ' + window.ethereum.version);
      } else {
        showResult('âŒ Test 2 FAILED: MetaMask NOT installed!\n\nPlease install MetaMask extension.');
      }
    }

    async function testBackend() {
      showResult('â³ Testing backend connection...');
      
      try {
        const response = await fetch('https://blockcall-demo-backend.glitch.me/');
        const data = await response.json();
        
        showResult('âœ… Test 3 PASSED: Backend is working!\n\n' + JSON.stringify(data, null, 2));
      } catch (error) {
        showResult('âŒ Test 3 FAILED: Cannot connect to backend\n\nError: ' + error.message);
      }
    }

    async function connectWallet() {
      try {
        if (typeof window.ethereum === 'undefined') {
          alert('âŒ MetaMask not installed!\n\nPlease install MetaMask extension first.');
          return;
        }

        showResult('â³ Connecting wallet...');

        const provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send('eth_requestAccounts', []);
        const signer = await provider.getSigner();
        wallet = await signer.getAddress();

        // Update UI
        document.getElementById('walletDisconnected').classList.add('hidden');
        document.getElementById('walletConnected').classList.remove('hidden');
        document.getElementById('walletAddress').textContent = wallet;

        showResult('âœ… Wallet connected!\n\nAddress: ' + wallet);

      } catch (error) {
        showResult('âŒ Wallet connection failed!\n\nError: ' + error.message);
      }
    }

    function disconnectWallet() {
      wallet = null;
      document.getElementById('walletDisconnected').classList.remove('hidden');
      document.getElementById('walletConnected').classList.add('hidden');
      showResult('ğŸ‘‹ Wallet disconnected');
    }

    // Auto-run tests on load
    window.addEventListener('load', () => {
      console.log('ğŸš€ BlockCall Test Page Loaded');
      console.log('ğŸ“ Current URL:', window.location.href);
      console.log('ğŸ”§ MetaMask:', typeof window.ethereum !== 'undefined' ? 'Installed âœ…' : 'Not Installed âŒ');
    });
  </script>
</body>
</html>
